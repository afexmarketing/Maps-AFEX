<!DOCTYPE html>
<html >
<head>
<meta charset="UTF-8">
<title>CodePen - Map with Buttons</title>
  <style>
      #map {
  width: 100%;
  height: 400px;
}
  </style>

<script src="https://maps.googleapis.com/maps/api/js"></script>
<script src="script.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

</head>
<body>
  <input type="checkbox" name="filter" id="sunday" class='chk-btn'>
  <label for='sunday'>Abierto los Domingos</label>
<br>
<br>
<div id="map"></div>
<br>

<script>
var map
var markers = []

// start out with filter features set to false, so no filtering happens by default
var filters = {sunday:false}

$(function () {
    $('input[name=filter]').change(function (e) {
     map_filter(this.id);
      filter_markers()
  });
})

var get_set_options = function() {
  ret_array = []
  for (option in filters) {if (window.CP.shouldStopExecution(1)){break;}
    if (filters[option]) {
      ret_array.push(option)
    }
  }
window.CP.exitedLoop(1);

  return ret_array;
}

var filter_markers = function() {  
  set_filters = get_set_options()
  
  // for each marker, check to see if all required options are set
  for (i = 0; i < markers.length; i++) {if (window.CP.shouldStopExecution(3)){break;}
    marker = markers[i];

    // start the filter check assuming the marker will be displayed
    // if any of the required features are missing, set 'keep' to false
    // to discard this marker
    keep=true
    mapset = map
    for (opt=0; opt<set_filters.length; opt++) {if (window.CP.shouldStopExecution(2)){break;}
      if (!marker.properties[set_filters[opt]]) {
        keep = false;
      }
    }
window.CP.exitedLoop(2);

    marker.setVisible(keep)
  }
window.CP.exitedLoop(3);

}

var map_filter = function(id_val) {
   if (filters[id_val]) 
      filters[id_val] = false
   else
      filters[id_val] = true
}
// avatar personalizado

     var customLabel = {
        calle: 'afexcalle.png',
        mall: 'afexmall.png',
        galeria: 'afexcalle.png',
        aeropuerto: 'afexaeropuerto.png'
      };

// after the geojson is loaded, iterate through the map data to create markers
// and add the pop up (info) windows
function loadMarkers() {
  console.log('creating markers')
  var infoWindow = new google.maps.InfoWindow()
  geojson_url = 'collection.geojson'
  $.getJSON(geojson_url, function(result) {
      // Post select to url.
      data = result['features']
      $.each(data, function(key, val) {
        var point = new google.maps.LatLng(
                parseFloat(val['geometry']['coordinates'][1]),
                parseFloat(val['geometry']['coordinates'][0]));
        var titleText = val['properties']['title']
        var descriptionText = val['properties']['description']
        var lunvieText = val['properties']['lunvie']
        var sabText = val['properties']['sab']
        var domText = val['properties']['dom']
        var tlfText = val['properties']['tlf']
        var icon = customLabel[val['properties']['tipo']] || {}
        var marker = new google.maps.Marker({
          position: point,
          title: titleText,
          map: map,
          properties: val['properties'],
          icon: icon
         });

        var markerInfo = "<div><h3>" + titleText + "</h3>Direcci&oacute;n: " + descriptionText + "<br>Horario:<br>Lunes a Viernes " + lunvieText + "hrs. <br>S&aacute;bado " + sabText + "hrs. <br>Domingo " + domText +"hrs.<br>Tel&eacute;fono " + tlfText + "</div>"


        marker.addListener('click', function() {
              infoWindow.close()
              infoWindow.setContent(markerInfo)
              infoWindow.open(map, marker)
            });
        markers.push(marker)
      });
  });
}

function initMap() {
    map_options = {
      zoom: 9,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      center: {lat: -33.2532062, lng: -70.9207003}
    }
    
    map_document = document.getElementById('map')
    map = new google.maps.Map(map_document,map_options);
    loadMarkers()
 
}

google.maps.event.addDomListener(window, 'load', initMap);
  //# sourceURL=pen.js
  </script>

</body>
</html>
